<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExoHunter System Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #0c1424;
            --secondary-bg: #1a2336;
            --text-primary: #e0e7ff;
            --text-secondary: #a7b3d1;
            --accent-color: #60a5fa;
            --border-color: #313c57;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            margin: 0;
            overflow: hidden;
        }
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            height: 100vh;
        }
        .data-panel {
            background-color: var(--secondary-bg);
            padding: 25px;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            z-index: 1;
        }
        .viewer-panel {
            position: relative;
        }
        #viewer-container {
            width: 100%;
            height: 100%;
            background-color: transparent;
        }
        h1, h2 {
            font-weight: 300;
            text-align: left;
            color: white;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 0;
        }
        h2 { font-size: 1.5em; }
        .selector-group { margin: 25px 0; }
        label { display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9em; }
        select { width: 100%; padding: 10px; border-radius: 5px; background-color: var(--primary-bg); color: var(--text-primary); border: 1px solid var(--border-color); font-size: 1em; }
        #planet-info p { margin: 10px 0; line-height: 1.6; color: var(--text-secondary); }
        #planet-info strong { color: var(--text-primary); }
        .viewer-text { position: absolute; bottom: 20px; left: 20px; color: white; background: rgba(0,0,0,0.5); padding: 8px 12px; border-radius: 5px; font-size: 1em; pointer-events: none; backdrop-filter: blur(5px); }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    <div class="main-container">
        <div class="data-panel">
            <h1>ExoHunter</h1>
            <div class="selector-group">
                <label for="planet-select">Kepler Object of Interest</label>
                <select id="planet-select" onchange="updateVisualization()"></select>
            </div>
            <div id="planet-info"></div>
        </div>
        <div class="viewer-panel">
            <div id="viewer-container"></div>
            <div id="viewer-title" class="viewer-text">Select a system to visualize</div>
        </div>
    </div>

<script>
    const exoplanetData = {
        "Kepler-22 b (KOI-87.01)":    { koi_prad: 2.38,  koi_srad: 0.98, koi_steff: 5518, koi_period: 289.9, koi_teq: 262 },
        "Kepler-62 f (KOI-701.04)":   { koi_prad: 1.41,  koi_srad: 0.64, koi_steff: 4925, koi_period: 267.3, koi_teq: 208 },
        "Kepler-186 f (KOI-571.05)":  { koi_prad: 1.17,  koi_srad: 0.52, koi_steff: 3755, koi_period: 129.9, koi_teq: 188 },
        "Kepler-452 b (KOI-7016.01)": { koi_prad: 1.63,  koi_srad: 1.11, koi_steff: 5757, koi_period: 384.8, koi_teq: 265 }
    };

    const viewer = {};

    document.addEventListener('DOMContentLoaded', () => {
        populateSelector();
        init3DViewer();
        updateVisualization();
        window.addEventListener('resize', onWindowResize);
    });

    function populateSelector() {
        const selector = document.getElementById('planet-select');
        for (const name in exoplanetData) {
            selector.add(new Option(name, name));
        }
    }

    function updateVisualization() {
        const selectedPlanetName = document.getElementById('planet-select').value;
        const data = exoplanetData[selectedPlanetName];
        displayPlanetInfo(selectedPlanetName, data);
        createSceneObjects(selectedPlanetName, data);
    }
    
    function displayPlanetInfo(name, data) {
        document.getElementById('planet-info').innerHTML = `
            <h2>${name}</h2>
            <p><strong>Planet Radius:</strong> ${data.koi_prad.toFixed(2)}x Earth</p>
            <p><strong>Host Star Radius:</strong> ${data.koi_srad.toFixed(2)}x Sun</p>
            <p><strong>Host Star Temp:</strong> ${data.koi_steff} K</p>
            <p><strong>Planet Temp (Equilibrium):</strong> ${data.koi_teq} K</p>
            <p><strong>Orbital Period:</strong> ${data.koi_period} days</p>
        `;
    }

    function init3DViewer() {
        const container = document.getElementById('viewer-container');
        viewer.scene = new THREE.Scene();
        viewer.camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 2000);
        viewer.camera.position.z = 70;
        
        viewer.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        viewer.renderer.setSize(container.clientWidth, container.clientHeight);
        viewer.renderer.setPixelRatio(window.devicePixelRatio);
        viewer.renderer.autoClear = false;
        container.appendChild(viewer.renderer.domElement);

        viewer.controls = new THREE.OrbitControls(viewer.camera, viewer.renderer.domElement);
        viewer.controls.enableDamping = true;
        
        viewer.starfieldScene = new THREE.Scene();
        const starVertices = [];
        for (let i = 0; i < 10000; i++) {
            starVertices.push(THREE.MathUtils.randFloatSpread(2000), THREE.MathUtils.randFloatSpread(2000), THREE.MathUtils.randFloatSpread(2000));
        }
        const starGeometry = new THREE.BufferGeometry();
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        const starMaterial = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.2 });
        const stars = new THREE.Points(starGeometry, starMaterial);
        viewer.starfieldScene.add(stars);

        animate();
    }

    function getStarProperties(temp) {
        if (temp > 7500) return { color: 0xa9c1ff, intensity: 2.5 };
        if (temp > 6000) return { color: 0xfff4e8, intensity: 2 };
        if (temp > 5200) return { color: 0xfff0a1, intensity: 1.8 };
        if (temp > 3700) return { color: 0xffcc6f, intensity: 1.5 };
        return { color: 0xff8c5a, intensity: 1.2 };
    }
    
    function createSceneObjects(name, data) {
        // --- START OF CHANGES ---
        
        if (viewer.activeGroup) {
            viewer.scene.remove(viewer.activeGroup);
        }
        viewer.activeGroup = new THREE.Group();
        const starProps = getStarProperties(data.koi_steff);

        // Create the star with a simple, glowing color material
        const starRadius = data.koi_srad * 15;
        const starGeometry = new THREE.SphereGeometry(starRadius, 64, 64);
        const starMaterial = new THREE.MeshBasicMaterial({
            color: starProps.color
        });
        const starMesh = new THREE.Mesh(starGeometry, starMaterial);
        
        // Create the planet with a simple, standard material color
        const planetRadius = data.koi_prad;
        const planetGeometry = new THREE.SphereGeometry(planetRadius, 32, 32);
        const planetMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x4f8a8b, // A nice teal color for the planet
            roughness: 0.8, 
            metalness: 0.1 
        });
        const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);
        
        // Add a light source inside the star so it illuminates the planet
        const mainLight = new THREE.PointLight(0xffffff, starProps.intensity, 1000);
        starMesh.add(mainLight);

        // NOTE: Corona, lens flare, and texture loading have been removed.

        const separation = starRadius + planetRadius + 20;
        starMesh.position.x = -separation / 2;
        planetMesh.position.x = separation / 2;

        viewer.activeGroup.add(starMesh, planetMesh);
        viewer.scene.add(viewer.activeGroup);
        document.getElementById('viewer-title').innerText = `System View: ${name}`;

        // --- END OF CHANGES ---
    }

    let clock = new THREE.Clock();
    function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();
        viewer.controls.update();

        if (viewer.activeGroup) {
            // REMOVED: Texture animation is no longer needed
            viewer.activeGroup.children[0].rotation.y += delta * 0.02; // Star rotation
            viewer.activeGroup.children[1].rotation.y += delta * 0.1;  // Planet rotation
        }
        
        viewer.renderer.clear();
        viewer.renderer.render(viewer.starfieldScene, viewer.camera);
        viewer.renderer.clearDepth();
        viewer.renderer.render(viewer.scene, viewer.camera);
    }

    function onWindowResize() {
        if (!viewer.camera) return;
        const container = document.getElementById('viewer-container');
        viewer.camera.aspect = container.clientWidth / container.clientHeight;
        viewer.camera.updateProjectionMatrix();
        viewer.renderer.setSize(container.clientWidth, container.clientHeight);
    }
</script>
</body>
</html>
