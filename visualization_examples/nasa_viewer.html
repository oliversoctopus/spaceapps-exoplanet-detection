<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exoplanet Data Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        html {
            height: 100%;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #111827;
            color: #F3F4F6;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        h1,h2{text-align:center;color:#93c5fd;text-shadow:0 0 5px #60a5fa}
        .tab-container{display:flex;justify-content:center;margin-bottom:20px;border-bottom:2px solid #374151}
        .tab-button{padding:12px 25px;cursor:pointer;border:none;background-color:transparent;color:#9CA3AF;font-size:1.1em;transition:all .3s ease;border-bottom:3px solid transparent}
        .tab-button.active{color:#60a5fa;border-bottom:3px solid #60a5fa}
        .content-section{
            display:none;
            flex-direction:row;
            flex-wrap:wrap;
            justify-content:center;
            gap:20px;
            animation:fadeIn .5s ease;
            flex-grow: 1;
            min-height: 0;
            overflow-y: auto;
        }
        .content-section.active{display:flex}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        
        .card {
            background-color: #1F2937;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,.4);
            flex: 1;
            min-width: 400px;
            max-width: 600px;
            display: flex;
            flex-direction: column;
        }
        .chart-container {
            position: relative;
            flex-grow: 1;
            min-height: 0;
        }

        .card h2{margin-top:0;border-bottom:1px solid #4B5563;padding-bottom:10px}
        #viewer-container-kepler,#viewer-container-tess{width:100%;height:400px;border-radius:8px;cursor:grab}
        .viewer-info{text-align:center;margin-top:15px;color:#D1D5DB;font-size:1.1em;height:40px}
    </style>
</head>
<body>

    <h1>NASA Exoplanet Data Explorer</h1>
    <div class="tab-container">
        <button class="tab-button active" onclick="showTab('kepler')">Kepler</button>
        <button class="tab-button" onclick="showTab('tess')">TESS</button>
    </div>
    <div id="kepler" class="content-section active">
        <div class="card">
            <h2>Planet Types Discovered by Kepler</h2>
            <div class="chart-container">
                <canvas id="keplerChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h2 id="viewer-title-kepler">3D Model Viewer</h2>
            <div id="viewer-container-kepler"></div>
            <div id="viewer-info-kepler" class="viewer-info">Click a bar on the chart to view a model.</div>
        </div>
    </div>
    <div id="tess" class="content-section">
        <div class="card">
            <h2>Planet Types Discovered by TESS</h2>
            <div class="chart-container">
                <canvas id="tessChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h2 id="viewer-title-tess">3D Model Viewer</h2>
            <div id="viewer-container-tess"></div>
            <div id="viewer-info-tess" class="viewer-info">Click a bar on the chart to view a model.</div>
        </div>
    </div>

<script>
    const keplerData = [{"type": "Gas Giant", "count": 772, "avg_radius": 74.26733652085493}, {"type": "Neptune-like", "count": 1690, "avg_radius": 5.986235083739644}, {"type": "Super Earth", "count": 12466, "avg_radius": 2.4554009696093373}, {"type": "Terrestrial", "count": 6561, "avg_radius": 1.2161419472900472}];
    const tessData = [{"type": "Gas Giant", "count": 439, "avg_radius": 13.265404409088838}, {"type": "Neptune-like", "count": 254, "avg_radius": 6.98897170484252}, {"type": "Super Earth", "count": 750, "avg_radius": 2.57999271588}, {"type": "Terrestrial", "count": 232, "avg_radius": 1.238601194612069}];

    const planetColors = {
        'Gas Giant':  0xD2B48C, // Tan
        'Super Earth': 0xAF4425, // Burnt Sienna
        'Neptune-like': 0x5B92E5, // Cornflower Blue
        'Terrestrial': 0x9F2B00, // Rust
        'Earth': 0x4F7CAC,      // Steel Blue
    };

    const viewers = {};
    const charts = {};

    window.onload = function() {
        const keplerChartData = processSummaryData(keplerData);
        viewers.kepler = setup3DViewer('viewer-container-kepler');
        createChart('keplerChart', keplerChartData, (type) => {
            const avgRadius = keplerChartData.avgRadii[type];
            update3DModel(viewers.kepler, type, avgRadius, 'kepler');
        });

        const tessChartData = processSummaryData(tessData);
        viewers.tess = setup3DViewer('viewer-container-tess');
        createChart('tessChart', tessChartData, (type) => {
            const avgRadius = tessChartData.avgRadii[type];
            update3DModel(viewers.tess, type, avgRadius, 'tess');
        });

        animate();
    };

    function processSummaryData(summaryArray) {
        summaryArray.sort((a, b) => a.type.localeCompare(b.type));
        const labels = summaryArray.map(item => item.type);
        const counts = summaryArray.map(item => item.count);
        const avgRadii = {};
        summaryArray.forEach(item => {
            avgRadii[item.type] = item.avg_radius;
        });
        return { labels, counts, avgRadii };
    }

    function createChart(canvasId, chartData, onClickCallback) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        return new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'Number of Planets Found',
                    data: chartData.counts,
                    backgroundColor: 'rgba(96, 165, 250, 0.6)',
                    borderColor: 'rgba(96, 165, 250, 1)',
                    borderWidth: 1,
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: {
                            color: '#9CA3AF',
                            callback: function(value) {
                                if (value >= 1000) {
                                    return (value / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
                                }
                                return value;
                            }
                        }
                    },
                    x: { ticks: { color: '#D1D5DB' }, grid: { display: false } }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const type = chartData.labels[elements[0].index];
                        onClickCallback(type);
                    }
                }
            }
        });
    }

    function setup3DViewer(containerId){const container=document.getElementById(containerId);const scene=new THREE.Scene();const camera=new THREE.PerspectiveCamera(75,container.clientWidth/container.clientHeight,.1,1e3);camera.position.z=5;const renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(container.clientWidth,container.clientHeight);renderer.setPixelRatio(window.devicePixelRatio);container.appendChild(renderer.domElement);const ambientLight=new THREE.AmbientLight(16777215,.4);scene.add(ambientLight);const pointLight=new THREE.PointLight(16777215,1);pointLight.position.set(5,5,5);scene.add(pointLight);const controls=new THREE.OrbitControls(camera,renderer.domElement);controls.enableDamping=!0;controls.dampingFactor=.05;const viewer={scene,camera,renderer,controls,container,activeMeshes:[]};return window.addEventListener("resize",()=>onWindowResize(viewer),!1),viewer}
    
    function update3DModel(viewer, type, radius, datasetKey) {
        viewer.activeMeshes.forEach(mesh => viewer.scene.remove(mesh));
        viewer.activeMeshes = [];
        const maxDisplayRadius = 2, earthDisplayRadius = 0.5;
        const planetDisplayRadius = Math.min(maxDisplayRadius, earthDisplayRadius * radius);
        const planetGeometry = new THREE.SphereGeometry(planetDisplayRadius, 64, 64);
        const planetMaterial = new THREE.MeshStandardMaterial({
            color: planetColors[type],
            roughness: 0.5
        });
        const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);
        planetMesh.position.x = -planetDisplayRadius - 0.5;
        const earthGeometry = new THREE.SphereGeometry(earthDisplayRadius, 64, 64);
        const earthMaterial = new THREE.MeshStandardMaterial({
            color: planetColors.Earth,
            roughness: 0.5
        });
        const earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
        earthMesh.position.x = earthDisplayRadius + 0.5;
        viewer.scene.add(planetMesh);
        viewer.scene.add(earthMesh);
        viewer.activeMeshes.push(planetMesh, earthMesh);
        document.getElementById(`viewer-title-${datasetKey}`).innerText = `3D Model: ${type}`;
        document.getElementById(`viewer-info-${datasetKey}`).innerText = `${type} (left, avg. radius: ${radius.toFixed(2)}x Earth) vs. Earth (right)`;
    }

    function animate(){requestAnimationFrame(animate);for(const key in viewers){const viewer=viewers[key];viewer.controls.update(),viewer.activeMeshes.forEach(mesh=>{mesh.rotation.y+=.002}),viewer.renderer.render(viewer.scene,viewer.camera)}}
    
    function onWindowResize(viewer){
        if (!viewer.container.clientWidth || !viewer.container.clientHeight) return;
        viewer.camera.aspect=viewer.container.clientWidth/viewer.container.clientHeight;
        viewer.camera.updateProjectionMatrix();
        viewer.renderer.setSize(viewer.container.clientWidth,viewer.container.clientHeight);
    }
    
    function showTab(tabName){
        document.querySelectorAll(".content-section").forEach(section=>{section.classList.remove("active")});
        document.querySelectorAll(".tab-button").forEach(button=>{button.classList.remove("active")});
        document.getElementById(tabName).classList.add("active");
        document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add("active");
        
        // This resizes the 3D viewer for the newly visible tab.
        onWindowResize(viewers[tabName]);
    }
</script>

</body>
</html>
